### 什么是单例模式？

单例模式是一种创建型设计模式，让你能够保证一个类只有一个实例，并提供一个访问该实例的全局节点。

### 如何实现单例模式？

1. 由于默认构造函数和拷贝构造函数都会创建新的实例，因此需要将他们设置为私有属性
2. 将类的实例和获取实例的方法都设置为静态

### 单例模式分类

1. 饿汉式：定义类的时候创建对象
2. 懒汉式：什么时候使用对象什么时候才创建实例，相比于饿汉式来说更加节省内存空间，只有使用的时候才用到内存空间。

### 线程安全问题

饿汉式没有线程安全问题，懒汉式有线程安全问题。这是因为在访问懒汉式的对象实例的时候，多个线程可能会创建多个实例，这就违背了单例模式的定义。

### 如何解决线程安全问题？

1. 双重检查锁定。用两层if语句判断实例对象是否为空，并在内存if语句里面加锁。但是这样的代码仍然存在问题，m_task = new TaskQueue对应三条指令：分配内存、在内存上创建对象、m_task指向该内存。正常情况下是没有问题的，如果指令被重排了，第二步和第三步顺序反了，并且线程在第二步被挂起了，此时m_task不等于nullptr，指向的是一块无效的内存空间，那后续线程访问的时候就会出现问题。
2. 使用原子变量可解决上述问题。
3. 使用静态局部对象解决线程安全问题（编译器要支持C++11）。C++11规定，当并发线程访问到未初始化的声明变量的时候，必须等待其初始化之后才能访问

### 为什么要使用单例模式而不直接使用全局变量？

直接使用全局变量破坏了封装的特性，通过单例模式的方式间接的访问成员变量，按照一定的规则才能访问，更加安全。
